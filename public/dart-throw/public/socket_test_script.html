<!doctype html>
<html>

<head>
  <meta charset="utf-8" />
  <title>Dart Socket Test</title>
  <style>
    body {
      font-family: system-ui, sans-serif;
      max-width: 800px;
      margin: 40px auto;
      padding: 20px;
      background: #f5f5f5;
    }

    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
    }

    h1 {
      margin-top: 0;
      color: #333;
    }

    h2 {
      color: #555;
      margin-top: 0;
      font-size: 18px;
    }

    .input-group {
      margin-bottom: 15px;
    }

    label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #666;
    }

    input {
      width: 100%;
      padding: 10px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }

    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 14px;
      cursor: pointer;
      margin-right: 10px;
      margin-bottom: 10px;
    }

    .btn-primary {
      background: #4CAF50;
      color: white;
    }

    .btn-primary:hover {
      background: #45a049;
    }

    .btn-danger {
      background: #f44336;
      color: white;
    }

    .btn-danger:hover {
      background: #da190b;
    }

    .btn-secondary {
      background: #2196F3;
      color: white;
    }

    .btn-secondary:hover {
      background: #0b7dda;
    }

    .status {
      padding: 12px;
      border-radius: 6px;
      margin-top: 10px;
      font-weight: 500;
    }

    .status.connected {
      background: #d4edda;
      color: #155724;
      border: 1px solid #c3e6cb;
    }

    .status.disconnected {
      background: #f8d7da;
      color: #721c24;
      border: 1px solid #f5c6cb;
    }

    .status.pending {
      background: #fff3cd;
      color: #856404;
      border: 1px solid #ffeaa7;
    }

    .client-info {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 15px;
      margin-top: 15px;
    }

    .client-box {
      border: 2px solid #ddd;
      border-radius: 8px;
      padding: 15px;
      background: #fafafa;
    }

    .client-box.active {
      border-color: #4CAF50;
      background: #f1f8f4;
    }

    .client-box .input-group {
      margin-bottom: 10px;
    }

    .client-box .input-group label {
      display: block;
      margin-bottom: 5px;
      font-weight: 500;
      color: #666;
      font-size: 14px;
    }

    .client-box .input-group input {
      width: 100%;
      padding: 8px;
      border: 1px solid #ddd;
      border-radius: 6px;
      font-size: 14px;
      box-sizing: border-box;
    }

    .client-id {
      font-family: monospace;
      font-size: 12px;
      color: #666;
      word-break: break-all;
      margin-top: 5px;
      white-space: pre-line;
    }

    .room-info {
      background: #e3f2fd;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
    }

    .player-count {
      font-size: 24px;
      font-weight: bold;
      color: #1976d2;
      margin: 10px 0;
    }

    .game-ready {
      background: #c8e6c9;
      color: #2e7d32;
      padding: 15px;
      border-radius: 8px;
      margin-top: 15px;
      font-weight: bold;
      text-align: center;
      display: none;
    }

    .game-ready.show {
      display: block;
    }

    .ranking-section {
      animation: slideDown 0.3s ease-out;
    }

    @keyframes slideDown {
      from {
        opacity: 0;
        transform: translateY(-20px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .ranking-item {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 12px;
      margin: 8px 0;
      background: white;
      border-radius: 8px;
      border: 1px solid #ddd;
    }

    .ranking-item.first {
      background: linear-gradient(135deg, #ffd700 0%, #ffed4e 100%);
      border-color: #ffc107;
      font-weight: bold;
    }

    .ranking-item.second {
      background: linear-gradient(135deg, #c0c0c0 0%, #e8e8e8 100%);
      border-color: #9e9e9e;
    }

    .ranking-rank {
      font-size: 24px;
      font-weight: bold;
      margin-right: 15px;
      min-width: 40px;
    }

    .ranking-name {
      flex: 1;
      font-size: 16px;
    }

    .ranking-score {
      font-size: 20px;
      font-weight: bold;
      color: #1976d2;
    }

    .log {
      background: #f9f9f9;
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 10px;
      max-height: 200px;
      overflow-y: auto;
      font-family: monospace;
      font-size: 12px;
      margin-top: 10px;
    }

    .log-entry {
      margin-bottom: 5px;
      padding: 3px 0;
      border-bottom: 1px solid #eee;
    }

    .log-entry:last-child {
      border-bottom: none;
    }

    .timestamp {
      color: #999;
      margin-right: 8px;
    }
  </style>
  <script src="https://cdn.socket.io/4.7.5/socket.io.min.js"></script>
</head>

<body>
  <div class="card">
    <h1>ğŸ¯ Dart Socket ì—°ê²° í…ŒìŠ¤íŠ¸</h1>

    <div class="input-group">
      <label>ì„œë²„ URL:</label>
      <input type="text" id="serverUrl" value="https://socket-relay.zipshowkorea.com" placeholder="https://socket-relay.zipshowkorea.com">
    </div>

    <div class="input-group">
      <label>Room ì½”ë“œ:</label>
      <input type="text" id="room" value="TEST" placeholder="TEST">
    </div>

    <div>
      <button class="btn-primary" id="connect1">í´ë¼ì´ì–¸íŠ¸ 1 ì—°ê²°</button>
      <button class="btn-primary" id="connect2">í´ë¼ì´ì–¸íŠ¸ 2 ì—°ê²°</button>
      <button class="btn-secondary" id="checkRoom">ë°© ì¸ì› í™•ì¸</button>
      <button class="btn-danger" id="disconnectAll">ëª¨ë‘ ì—°ê²° í•´ì œ</button>
      <button class="btn-primary" id="finishGame" style="background: #ff9800; border-color: #ff9800;">ê²Œì„ ì™„ë£Œ</button>
    </div>

    <div class="client-info">
      <div class="client-box" id="client1">
        <h2>í´ë¼ì´ì–¸íŠ¸ 1</h2>
        <div class="input-group">
          <label>ì´ë¦„:</label>
          <input type="text" id="name1" placeholder="Player 1" value="Player 1" />
        </div>
        <div class="status disconnected" id="status1">ì—°ê²° ì•ˆë¨</div>
        <div class="client-id" id="clientId1">-</div>
        <div class="score-section" id="scoreSection1" style="display: none; margin-top: 15px;">
          <label style="font-weight: 500; margin-bottom: 8px; display: block;">ì ìˆ˜ ì„ íƒ:</label>
          <div class="score-buttons" style="display: flex; gap: 8px;">
            <button class="btn-score" data-client="1" data-score="50">50</button>
            <button class="btn-score" data-client="1" data-score="100">100</button>
            <button class="btn-score" data-client="1" data-score="80">80</button>
          </div>
          <div style="margin-top: 10px; font-weight: 500;">
            í˜„ì¬ ì ìˆ˜: <span id="currentScore1">0</span>
          </div>
        </div>
      </div>

      <div class="client-box" id="client2">
        <h2>í´ë¼ì´ì–¸íŠ¸ 2</h2>
        <div class="input-group">
          <label>ì´ë¦„:</label>
          <input type="text" id="name2" placeholder="Player 2" value="Player 2" />
        </div>
        <div class="status disconnected" id="status2">ì—°ê²° ì•ˆë¨</div>
        <div class="client-id" id="clientId2">-</div>
        <div class="score-section" id="scoreSection2" style="display: none; margin-top: 15px;">
          <label style="font-weight: 500; margin-bottom: 8px; display: block;">ì ìˆ˜ ì„ íƒ:</label>
          <div class="score-buttons" style="display: flex; gap: 8px;">
            <button class="btn-score" data-client="2" data-score="50">50</button>
            <button class="btn-score" data-client="2" data-score="100">100</button>
            <button class="btn-score" data-client="2" data-score="80">80</button>
          </div>
          <div style="margin-top: 10px; font-weight: 500;">
            í˜„ì¬ ì ìˆ˜: <span id="currentScore2">0</span>
          </div>
        </div>
      </div>
    </div>

    <div class="room-info">
      <h2>ë°© ì •ë³´</h2>
      <div>Room: <strong id="roomDisplay">-</strong></div>
      <div class="player-count">ì ‘ì† ì¸ì›: <span id="playerCount">0</span> / 2</div>
    </div>

    <div class="game-ready" id="gameReady">
      âœ… ê²Œì„ ì‹œì‘ ê°€ëŠ¥! (2ëª… ì ‘ì† ì™„ë£Œ)
    </div>

    <div class="ranking-section" id="rankingSection" style="display: none; margin-top: 20px;">
      <div class="card" style="background: #fff3cd; border: 2px solid #ffc107;">
        <h2 style="margin-top: 0; color: #856404;">ğŸ† ìµœì¢… ìˆœìœ„</h2>
        <div id="rankingList"></div>
      </div>
    </div>

    <div class="log" id="log"></div>
  </div>

  <script>
    let socket1 = null;
    let socket2 = null;
    let playerCount = 0;
    let playerScore1 = 0;
    let playerScore2 = 0;
    let playerName1 = '';
    let playerName2 = '';

    const serverUrlInput = document.getElementById('serverUrl');
    const roomInput = document.getElementById('room');
    const name1Input = document.getElementById('name1');
    const name2Input = document.getElementById('name2');
    const connect1Btn = document.getElementById('connect1');
    const connect2Btn = document.getElementById('connect2');
    const checkRoomBtn = document.getElementById('checkRoom');
    const disconnectAllBtn = document.getElementById('disconnectAll');
    const finishGameBtn = document.getElementById('finishGame');
    const rankingSection = document.getElementById('rankingSection');
    const rankingList = document.getElementById('rankingList');
    const status1 = document.getElementById('status1');
    const status2 = document.getElementById('status2');
    const clientId1 = document.getElementById('clientId1');
    const clientId2 = document.getElementById('clientId2');
    const roomDisplay = document.getElementById('roomDisplay');
    const playerCountDisplay = document.getElementById('playerCount');
    const gameReady = document.getElementById('gameReady');
    const logDiv = document.getElementById('log');
    const client1Box = document.getElementById('client1');
    const client2Box = document.getElementById('client2');
    const scoreSection1 = document.getElementById('scoreSection1');
    const scoreSection2 = document.getElementById('scoreSection2');
    const currentScore1 = document.getElementById('currentScore1');
    const currentScore2 = document.getElementById('currentScore2');

    function log(message) {
      const now = new Date();
      const timestamp = now.toLocaleTimeString();
      const entry = document.createElement('div');
      entry.className = 'log-entry';
      entry.innerHTML = `<span class="timestamp">[${timestamp}]</span>${message}`;
      logDiv.appendChild(entry);
      logDiv.scrollTop = logDiv.scrollHeight;
    }

    function updateStatus(clientNum, isConnected, socketId, playerName) {
      const status = clientNum === 1 ? status1 : status2;
      const clientId = clientNum === 1 ? clientId1 : clientId2;
      const clientBox = clientNum === 1 ? client1Box : client2Box;
      const scoreSection = clientNum === 1 ? scoreSection1 : scoreSection2;

      if (isConnected) {
        status.textContent = `âœ… ì—°ê²°ë¨`;
        status.className = 'status connected';
        clientId.textContent = `ì´ë¦„: ${playerName || 'Unknown'}\nSocket ID: ${socketId}`;
        clientBox.classList.add('active');
        scoreSection.style.display = 'block';
      } else {
        status.textContent = 'âŒ ì—°ê²° ì•ˆë¨';
        status.className = 'status disconnected';
        clientId.textContent = '-';
        clientBox.classList.remove('active');
        scoreSection.style.display = 'none';
        // ì ìˆ˜ ì´ˆê¸°í™”
        if (clientNum === 1) {
          playerScore1 = 0;
          currentScore1.textContent = '0';
        } else {
          playerScore2 = 0;
          currentScore2.textContent = '0';
        }
      }
    }

    function updateScore(clientNum, score) {
      const room = roomInput.value.trim() || 'TEST';
      const socket = clientNum === 1 ? socket1 : socket2;
      const playerName = clientNum === 1 ? playerName1 : playerName2;
      const currentScoreElement = clientNum === 1 ? currentScore1 : currentScore2;

      if (!socket || !socket.connected) {
        log(`âŒ í´ë¼ì´ì–¸íŠ¸ ${clientNum}ê°€ ì—°ê²°ë˜ì–´ ìˆì§€ ì•ŠìŠµë‹ˆë‹¤.`);
        return;
      }

      // ì ìˆ˜ ì¶”ê°€
      if (clientNum === 1) {
        playerScore1 += score;
        currentScore1.textContent = playerScore1;
      } else {
        playerScore2 += score;
        currentScore2.textContent = playerScore2;
      }

      log(`ğŸ“Š í´ë¼ì´ì–¸íŠ¸ ${clientNum} (${playerName}) ì ìˆ˜ ì¶”ê°€: ${score}ì  (ì´: ${clientNum === 1 ? playerScore1 : playerScore2}ì )`);

      // throw-dart ì´ë²¤íŠ¸ë¡œ ì„œë²„ì— ì „ì†¡
      socket.emit('throw-dart', {
        room: room.toUpperCase(),
        name: playerName,
        score: score, // ì ìˆ˜ ì¶”ê°€
        aim: {
          x: 0,
          y: 0
        }
      });
    }

    function updateRoomInfo() {
      const room = roomInput.value || 'TEST';
      roomDisplay.textContent = room.toUpperCase();

      // ì‹¤ì œë¡œëŠ” ì„œë²„ì—ì„œ ë°© ì¸ì›ì„ ê°€ì ¸ì™€ì•¼ í•˜ì§€ë§Œ,
      // í…ŒìŠ¤íŠ¸ë¥¼ ìœ„í•´ í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìˆ˜ë¡œ í‘œì‹œ
      let count = 0;
      if (socket1 && socket1.connected) count++;
      if (socket2 && socket2.connected) count++;

      playerCount = count;
      playerCountDisplay.textContent = count;

      if (count >= 2) {
        gameReady.classList.add('show');
      } else {
        gameReady.classList.remove('show');
      }
    }

    function updateButtonText(clientNum, isConnected) {
      const button = clientNum === 1 ? connect1Btn : connect2Btn;
      button.textContent = isConnected ? `í´ë¼ì´ì–¸íŠ¸ ${clientNum} í•´ì œ` : `í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²°`;
      if (isConnected) {
        button.classList.remove('btn-primary');
        button.classList.add('btn-danger');
      } else {
        button.classList.remove('btn-danger');
        button.classList.add('btn-primary');
      }
    }

    function disconnectClient(clientNum) {
      if (clientNum === 1 && socket1) {
        socket1.disconnect();
        socket1 = null;
        playerName1 = '';
        updateStatus(1, false, '', '');
        updateButtonText(1, false);
        log(`í´ë¼ì´ì–¸íŠ¸ 1 ì—°ê²° í•´ì œë¨`);
        updateRoomInfo();
      } else if (clientNum === 2 && socket2) {
        socket2.disconnect();
        socket2 = null;
        playerName2 = '';
        updateStatus(2, false, '', '');
        updateButtonText(2, false);
        log(`í´ë¼ì´ì–¸íŠ¸ 2 ì—°ê²° í•´ì œë¨`);
        updateRoomInfo();
      }
    }

    function connectClient(clientNum) {
      const serverUrl = serverUrlInput.value.trim() || 'https://socket-relay.zipshowkorea.com';
      const room = roomInput.value.trim() || 'TEST';
      const nameInput = clientNum === 1 ? name1Input : name2Input;
      const playerName = nameInput.value.trim() || `Player ${clientNum}`;

      log(`í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²° ì‹œë„: ${serverUrl}/dart, room: ${room}, name: ${playerName}`);

      const socket = io(`${serverUrl}/dart`, {
        query: {
          room: room.toUpperCase(),
          name: playerName
        },
        reconnection: false,
        transports: ['websocket', 'polling']
      });

      socket.on('connect', () => {
        log(`âœ… í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²° ì„±ê³µ! Socket ID: ${socket.id}, Name: ${playerName}`);

        if (clientNum === 1) {
          socket1 = socket;
          playerName1 = playerName;
          updateStatus(1, true, socket.id, playerName);
          updateButtonText(1, true);
        } else {
          socket2 = socket;
          playerName2 = playerName;
          updateStatus(2, true, socket.id, playerName);
          updateButtonText(2, true);
        }

        // joinRoom ì´ë²¤íŠ¸ ì „ì†¡ (ì´ë¦„ í¬í•¨)
        socket.emit('joinRoom', {
          room: room.toUpperCase(),
          name: playerName
        });
        updateRoomInfo();
      });

      socket.on('joinedRoom', (data) => {
        const room = typeof data === 'string' ? data : data.room;
        const count = typeof data === 'object' && data.playerCount !== undefined ? data.playerCount : null;
        log(`âœ… í´ë¼ì´ì–¸íŠ¸ ${clientNum} ë°© ì…ì¥ ì™„ë£Œ: ${room}${count !== null ? ` (í˜„ì¬ ì¸ì›: ${count}ëª…)` : ''}`);
        if (count !== null) {
          playerCount = count;
          updateRoomInfo();
        }
      });

      socket.on('clientInfo', (data) => {
        if (data && data.socketId && data.name) {
          const currentName = clientNum === 1 ? playerName1 : playerName2;
          if (data.name !== currentName) {
            log(`â„¹ï¸ í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì •ë³´ ì—…ë°ì´íŠ¸: ì´ë¦„=${data.name}, Socket ID=${data.socketId}`);
            if (clientNum === 1) {
              playerName1 = data.name;
              updateStatus(1, true, data.socketId, data.name);
            } else {
              playerName2 = data.name;
              updateStatus(2, true, data.socketId, data.name);
            }
          }
        }
      });

      socket.on('roomPlayerCount', (data) => {
        if (data && typeof data.playerCount === 'number') {
          playerCount = data.playerCount;
          log(`ğŸ“Š ë°© ì¸ì› ì—…ë°ì´íŠ¸: ${data.playerCount}ëª…`);
          updateRoomInfo();
        }
      });

      // throw-dart ì‘ë‹µ ìˆ˜ì‹  (ë‹¤ë¥¸ í´ë¼ì´ì–¸íŠ¸ì˜ ì ìˆ˜)
      socket.on('dart-thrown', (data) => {
        log(`ğŸ¯ ë‹¤íŠ¸ ë˜ì§: ${data.name} - ì ìˆ˜: ${data.score || 'N/A'}, Aim: ${JSON.stringify(data.aim)}`);
      });

      // ê²Œì„ ê²°ê³¼ ìˆ˜ì‹  (win/lose)
      socket.on('game-result', (data) => {
        // ìì‹ ì˜ socketIdë¡œ ê²°ê³¼ ì°¾ê¸°
        const myResult = data.results && data.results[socket.id];
        if (myResult) {
          const resultEmoji = myResult.result === 'win' ? 'ğŸ†' : myResult.result === 'tie' ? 'ğŸ¤' : 'ğŸ˜¢';
          const resultText = myResult.result === 'win' ? 'ìŠ¹ë¦¬!' : myResult.result === 'tie' ? 'ë¬´ìŠ¹ë¶€!' : 'íŒ¨ë°°';
          log(`${resultEmoji} í´ë¼ì´ì–¸íŠ¸ ${clientNum} ê²Œì„ ê²°ê³¼: ${resultText} (${myResult.rank}ìœ„, ${myResult.score}ì )`);

          // í´ë¼ì´ì–¸íŠ¸ ìƒíƒœ ì—…ë°ì´íŠ¸
          if (clientNum === 1) {
            updateStatus(1, true, socket.id, `${playerName1} - ${resultText}`);
          } else {
            updateStatus(2, true, socket.id, `${playerName2} - ${resultText}`);
          }
        }
      });

      // ê²Œì„ ì™„ë£Œ ì•Œë¦¼ ìˆ˜ì‹ 
      socket.on('game-finished', (data) => {
        log(`ğŸ® ê²Œì„ ì™„ë£Œ! ë°©: ${data.room}`);
        if (data.ranking && data.ranking.length > 0) {
          log('ìµœì¢… ìˆœìœ„:');
          data.ranking.forEach((player, index) => {
            log(`  ${index + 1}ìœ„: ${player.name} - ${player.score}ì `);
          });
        }
      });

      socket.on('connect_error', (error) => {
        log(`âŒ í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²° ì‹¤íŒ¨: ${error.message}`);
        if (clientNum === 1) {
          playerName1 = '';
          updateStatus(1, false, '', '');
          updateButtonText(1, false);
        } else {
          playerName2 = '';
          updateStatus(2, false, '', '');
          updateButtonText(2, false);
        }
        updateRoomInfo();
      });

      socket.on('disconnect', () => {
        log(`âš ï¸ í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—°ê²° í•´ì œ`);
        if (clientNum === 1) {
          updateStatus(1, false, '', '');
          socket1 = null;
          playerName1 = '';
          updateButtonText(1, false);
        } else {
          updateStatus(2, false, '', '');
          socket2 = null;
          playerName2 = '';
          updateButtonText(2, false);
        }
        updateRoomInfo();
      });

      socket.on('error', (error) => {
        log(`âŒ í´ë¼ì´ì–¸íŠ¸ ${clientNum} ì—ëŸ¬: ${JSON.stringify(error)}`);
      });
    }

    function toggleClient(clientNum) {
      const isConnected = (clientNum === 1 && socket1 && socket1.connected) ||
        (clientNum === 2 && socket2 && socket2.connected);

      if (isConnected) {
        disconnectClient(clientNum);
      } else {
        connectClient(clientNum);
      }
    }

    connect1Btn.onclick = () => toggleClient(1);
    connect2Btn.onclick = () => toggleClient(2);

    checkRoomBtn.onclick = () => {
      const room = roomInput.value.trim() || 'TEST';
      log(`ë°© ì¸ì› í™•ì¸ ìš”ì²­: ${room}`);

      // ì‹¤ì œë¡œëŠ” ì„œë²„ APIë¡œ ë°© ì¸ì›ì„ í™•ì¸í•´ì•¼ í•˜ì§€ë§Œ,
      // í˜„ì¬ëŠ” í´ë¼ì´ì–¸íŠ¸ ì—°ê²° ìƒíƒœë§Œ í‘œì‹œ
      updateRoomInfo();
      log(`í˜„ì¬ ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸: ${playerCount}ëª…`);

      if (playerCount >= 2) {
        log('âœ… ê²Œì„ ì‹œì‘ ê°€ëŠ¥ (2ëª… ì ‘ì† ì™„ë£Œ)');
      } else {
        log(`âš ï¸ ê²Œì„ ì‹œì‘ ë¶ˆê°€ (í˜„ì¬ ${playerCount}ëª…, 2ëª… í•„ìš”)`);
      }
    };

    disconnectAllBtn.onclick = () => {
      log('ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì—°ê²° í•´ì œ ì¤‘...');

      if (socket1) {
        socket1.disconnect();
        socket1 = null;
        playerName1 = '';
        updateStatus(1, false, '', '');
        updateButtonText(1, false);
      }

      if (socket2) {
        socket2.disconnect();
        socket2 = null;
        playerName2 = '';
        updateStatus(2, false, '', '');
        updateButtonText(2, false);
      }

      updateRoomInfo();
      rankingSection.style.display = 'none';
      log('ëª¨ë“  í´ë¼ì´ì–¸íŠ¸ ì—°ê²° í•´ì œ ì™„ë£Œ');
    };

    function showRanking() {
      const players = [];

      // ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ë§Œ ìˆœìœ„ì— í¬í•¨
      if (socket1 && socket1.connected && playerName1) {
        players.push({
          name: playerName1,
          score: playerScore1,
          clientNum: 1,
          socketId: socket1.id
        });
      }

      if (socket2 && socket2.connected && playerName2) {
        players.push({
          name: playerName2,
          score: playerScore2,
          clientNum: 2,
          socketId: socket2.id
        });
      }

      if (players.length === 0) {
        log('âš ï¸ ìˆœìœ„ë¥¼ í‘œì‹œí•  í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ì ìˆ˜ ìˆœìœ¼ë¡œ ì •ë ¬ (ë‚´ë¦¼ì°¨ìˆœ)
      players.sort((a, b) => b.score - a.score);

      // ìˆœìœ„ í‘œì‹œ
      rankingList.innerHTML = '';
      players.forEach((player, index) => {
        const rank = index + 1;
        const rankEmoji = rank === 1 ? 'ğŸ¥‡' : rank === 2 ? 'ğŸ¥ˆ' : 'ğŸ¥‰';
        const rankClass = rank === 1 ? 'first' : rank === 2 ? 'second' : '';

        const item = document.createElement('div');
        item.className = `ranking-item ${rankClass}`;
        item.innerHTML = `
          <div class="ranking-rank">${rankEmoji} ${rank}ìœ„</div>
          <div class="ranking-name">${player.name}</div>
          <div class="ranking-score">${player.score}ì </div>
        `;
        rankingList.appendChild(item);
      });

      rankingSection.style.display = 'block';
      log(`ğŸ† ìµœì¢… ìˆœìœ„ ë°œí‘œ! (ì´ ${players.length}ëª…)`);
      players.forEach((player, index) => {
        log(`${index + 1}ìœ„: ${player.name} - ${player.score}ì `);
      });

      // ìŠ¤í¬ë¡¤ì„ ìˆœìœ„ ì„¹ì…˜ìœ¼ë¡œ ì´ë™
      rankingSection.scrollIntoView({
        behavior: 'smooth',
        block: 'nearest'
      });
    }

    finishGameBtn.onclick = () => {
      const room = roomInput.value.trim() || 'TEST';
      const players = [];

      // ì—°ê²°ëœ í´ë¼ì´ì–¸íŠ¸ì˜ ì ìˆ˜ ì •ë³´ ìˆ˜ì§‘
      if (socket1 && socket1.connected && playerName1) {
        players.push({
          socketId: socket1.id,
          name: playerName1,
          score: playerScore1
        });
      }

      if (socket2 && socket2.connected && playerName2) {
        players.push({
          socketId: socket2.id,
          name: playerName2,
          score: playerScore2
        });
      }

      if (players.length === 0) {
        log('âš ï¸ ê²Œì„ ì™„ë£Œí•  í”Œë ˆì´ì–´ê°€ ì—†ìŠµë‹ˆë‹¤.');
        return;
      }

      // ì„œë²„ë¡œ ê²Œì„ ì™„ë£Œ ì´ë²¤íŠ¸ ì „ì†¡
      if (socket1 && socket1.connected) {
        socket1.emit('finish-game', {
          room: room.toUpperCase(),
          scores: players
        });
      } else if (socket2 && socket2.connected) {
        socket2.emit('finish-game', {
          room: room.toUpperCase(),
          scores: players
        });
      }

      // ë¡œì»¬ ìˆœìœ„ í‘œì‹œ
      showRanking();
    };

    // ì ìˆ˜ ë²„íŠ¼ ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
    document.querySelectorAll('.btn-score').forEach(button => {
      button.addEventListener('click', () => {
        const clientNum = parseInt(button.getAttribute('data-client'));
        const score = parseInt(button.getAttribute('data-score'));
        updateScore(clientNum, score);
      });
    });

    // ì´ˆê¸° ë¡œê·¸ ë° ë²„íŠ¼ ìƒíƒœ ì„¤ì •
    log('í…ŒìŠ¤íŠ¸ í˜ì´ì§€ ë¡œë“œ ì™„ë£Œ');
    updateButtonText(1, false);
    updateButtonText(2, false);
    updateRoomInfo();
  </script>
</body>

</html>